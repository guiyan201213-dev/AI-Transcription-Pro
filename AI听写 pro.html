<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI å¬å†™ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- iOS é£æ ¼æ·±åº¦å®šåˆ¶ --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", "Noto Sans SC", sans-serif;
            background-color: #F2F2F7; /* iOS ç³»ç»ŸèƒŒæ™¯ç° */
            color: #000;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }

        /* éšè—æ»šåŠ¨æ¡ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* iOS é£æ ¼æ»‘å— */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #FFFFFF;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1);
            margin-top: -12px;
            transition: transform 0.1s;
        }
        input[type=range]:active::-webkit-slider-thumb { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #E5E5EA;
            border-radius: 2px;
        }
        
        /* é€‰ä¸­çŠ¶æ€çš„æ»‘å—å·¦ä¾§é¢œè‰²éœ€è¦JSåŠ¨æ€å¤„ç†ï¼Œè¿™é‡Œç”¨åŸºç¡€è‰² */
        
        /* æ¯›ç»ç’ƒæ•ˆæœ */
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid rgba(0,0,0,0.05);
        }

        /* å‘¼å¸é«˜äº®åŠ¨ç”» */
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(0, 122, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 122, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 122, 255, 0); }
        }
        .animate-listening {
            animation: pulse-blue 2s infinite;
        }

        /* å¡ç‰‡é˜´å½± */
        .ios-card {
            background: #FFFFFF;
            border-radius: 20px; /* æ›´å¤§çš„åœ†è§’ */
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        }

        /* æŒ‰é’®ç‚¹å‡»æ€ */
        .active-scale:active {
            transform: scale(0.96);
            opacity: 0.9;
        }
    </style>
</head>
<body class="pb-32 pt-safe">

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="fixed top-0 w-full z-50 glass transition-all duration-300">
        <div class="max-w-md mx-auto px-5 h-14 flex items-center justify-between">
            <h1 class="text-lg font-bold tracking-tight text-slate-900">AI å¬å†™ Pro</h1>
            <button id="clearBtn" class="text-[15px] font-medium text-blue-500 active:opacity-50 px-2 py-1">
                æ¸…ç©º
            </button>
        </div>
    </header>

    <!-- å ä½ç¬¦ï¼Œé˜²æ­¢å†…å®¹è¢« Header é®æŒ¡ -->
    <div class="h-16"></div>

    <main class="max-w-md mx-auto px-4 space-y-5">
        
        <!-- æ ¸å¿ƒåŠŸèƒ½åŒºï¼šè¾“å…¥ä¸å±•ç¤ºåˆ‡æ¢ -->
        <section class="ios-card overflow-hidden transition-all duration-300 relative group">
            
            <!-- 1. ç¼–è¾‘æ¨¡å¼ -->
            <div id="editMode" class="p-5 transition-opacity duration-300">
                <div class="flex justify-between items-center mb-3">
                    <label class="text-[13px] font-semibold text-slate-400 uppercase tracking-wider">è¯è¯­åˆ—è¡¨</label>
                    <span id="wordCount" class="text-[13px] text-slate-400 font-medium bg-slate-100 px-2 py-0.5 rounded-md">0</span>
                </div>
                <textarea id="wordInput" 
                    class="w-full h-40 text-[17px] leading-relaxed p-0 border-0 focus:ring-0 resize-none placeholder-slate-300 bg-transparent text-slate-800" 
                    placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´è¯è¯­...&#10;æ”¯æŒç©ºæ ¼ã€é€—å·ã€æ¢è¡Œåˆ†éš”&#10;ä¾‹å¦‚ï¼šè‹¹æœï¼Œé¦™è•‰ï¼Œå¤§è¥¿ç“œ"></textarea>
            </div>

            <!-- 2. å¬å†™æ¨¡å¼ (åˆå§‹éšè—) -->
            <div id="playMode" class="hidden absolute inset-0 bg-white p-5 flex-col items-center justify-center text-center z-10">
                <div class="mb-4">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">CURRENT WORD</span>
                </div>
                <!-- å½“å‰å¤§å­— -->
                <div id="currentWordBig" class="text-4xl font-bold text-slate-900 mb-6 transition-all duration-300 transform scale-100">
                    å‡†å¤‡å¼€å§‹
                </div>
                <!-- è¿›åº¦æ¡ -->
                <div class="w-full h-1.5 bg-slate-100 rounded-full mb-2 overflow-hidden">
                    <div id="progressBar" class="h-full bg-blue-500 w-0 transition-all duration-500 ease-out"></div>
                </div>
                <div class="flex justify-between w-full text-xs text-slate-400 font-medium px-1">
                    <span id="progressText">0/0</span>
                    <span id="statusText">ç­‰å¾…å¼€å§‹</span>
                </div>
            </div>
        </section>

        <!-- è®¾ç½®é¢æ¿ -->
        <section class="ios-card p-5 space-y-7">
            <!-- è¯­é€Ÿ -->
            <div>
                <div class="flex justify-between mb-3 items-center">
                    <div class="flex items-center gap-2">
                        <div class="w-7 h-7 rounded-full bg-blue-50 flex items-center justify-center text-blue-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>
                        <span class="text-[15px] font-medium text-slate-700">æœ—è¯»è¯­é€Ÿ</span>
                    </div>
                    <span id="rateDisplay" class="text-[15px] font-semibold text-slate-900 font-mono">1.0x</span>
                </div>
                <input type="range" id="rateInput" min="0.5" max="1.5" step="0.1" value="0.8">
            </div>

            <!-- é—´éš” -->
            <div>
                <div class="flex justify-between mb-3 items-center">
                    <div class="flex items-center gap-2">
                        <div class="w-7 h-7 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                        </div>
                        <span class="text-[15px] font-medium text-slate-700">ä¹¦å†™é—´éš”</span>
                    </div>
                    <span id="intervalDisplay" class="text-[15px] font-semibold text-slate-900 font-mono">5s</span>
                </div>
                <input type="range" id="intervalInput" min="2" max="20" step="1" value="5">
            </div>

            <!-- é‡å¤æ¬¡æ•° (Segmented Control) -->
            <div>
                <div class="flex items-center gap-2 mb-3">
                    <div class="w-7 h-7 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-500">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/></svg>
                    </div>
                    <span class="text-[15px] font-medium text-slate-700">é‡å¤æœ—è¯»</span>
                </div>
                <div class="bg-slate-100 p-1 rounded-xl flex">
                    <button class="repeat-opt flex-1 py-2 rounded-lg text-sm font-semibold text-slate-500 transition-all" data-val="1">1é</button>
                    <button class="repeat-opt flex-1 py-2 rounded-lg text-sm font-semibold text-slate-500 transition-all shadow-sm bg-white text-slate-900" data-val="2">2é</button>
                    <button class="repeat-opt flex-1 py-2 rounded-lg text-sm font-semibold text-slate-500 transition-all" data-val="3">3é</button>
                </div>
            </div>
        </section>

    </main>

    <!-- åº•éƒ¨æ‚¬æµ®æ§åˆ¶æ  -->
    <footer class="fixed bottom-6 left-0 right-0 px-4 z-40">
        <div class="max-w-md mx-auto grid grid-cols-4 gap-3">
            <!-- åœæ­¢æŒ‰é’® -->
            <button id="stopBtn" class="col-span-1 bg-white text-slate-400 font-bold rounded-2xl h-14 shadow-lg shadow-slate-200/50 flex items-center justify-center active-scale transition-colors disabled:opacity-50" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>
            </button>
            
            <!-- ä¸»æ’­æ”¾æŒ‰é’® -->
            <button id="mainActionBtn" class="col-span-3 bg-[#007AFF] text-white font-bold rounded-2xl h-14 shadow-lg shadow-blue-500/30 flex items-center justify-center gap-3 text-lg active-scale transition-all">
                <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M5 3l14 9-14 9V3z"/></svg>
                <span id="btnText">å¼€å§‹å¬å†™</span>
            </button>
        </div>
    </footer>

    <script>
        /**
         * é€»è¾‘æ§åˆ¶å™¨ - è§£å†³ iOS/Android éŸ³é¢‘ç­–ç•¥é—®é¢˜
         */
        const App = {
            data: {
                words: [],
                currentIndex: 0,
                repeatCount: 0,
                isPlaying: false,
                isPaused: false,
                isWaiting: false,
                timer: null,
                settings: {
                    rate: 0.8,
                    interval: 5,
                    repeats: 2
                }
            },
            
            els: {},
            synth: window.speechSynthesis,
            voices: [],

            init() {
                // ç»‘å®š DOM å…ƒç´ 
                this.bindElements();
                // æ¢å¤æ•°æ®
                this.loadState();
                // ç»‘å®šäº‹ä»¶
                this.addListeners();
                // é¢„åŠ è½½è¯­éŸ³åˆ—è¡¨ï¼ˆè§£å†³ Chrome é¦–æ¬¡æ— è¯­éŸ³é—®é¢˜ï¼‰
                if (this.synth.onvoiceschanged !== undefined) {
                    this.synth.onvoiceschanged = () => this.voices = this.synth.getVoices();
                }
            },

            bindElements() {
                const $ = (id) => document.getElementById(id);
                const $all = (sel) => document.querySelectorAll(sel);
                this.els = {
                    input: $('wordInput'),
                    clearBtn: $('clearBtn'),
                    count: $('wordCount'),
                    editMode: $('editMode'),
                    playMode: $('playMode'),
                    currentWord: $('currentWordBig'),
                    progressBar: $('progressBar'),
                    progressText: $('progressText'),
                    statusText: $('statusText'),
                    rateInput: $('rateInput'),
                    rateDisp: $('rateDisplay'),
                    intInput: $('intervalInput'),
                    intDisp: $('intervalDisplay'),
                    repeatOpts: $all('.repeat-opt'),
                    mainBtn: $('mainActionBtn'),
                    stopBtn: $('stopBtn'),
                    btnText: $('btnText'),
                    playIcon: $('playIcon')
                };
            },

            addListeners() {
                // è¾“å…¥ç›‘å¬
                this.els.input.addEventListener('input', () => {
                    this.processWords();
                    this.saveState();
                });

                // æ¸…ç©ºæŒ‰é’® (ä¿®å¤äº†ä¹‹å‰çš„ Bug)
                this.els.clearBtn.addEventListener('click', () => {
                    if(this.els.input.value.trim() === '') return;
                    if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                        this.els.input.value = '';
                        this.processWords();
                        this.stop();
                        this.saveState();
                    }
                });

                // æ’­æ”¾/æš‚åœæŒ‰é’® (æ ¸å¿ƒé€»è¾‘)
                this.els.mainBtn.addEventListener('click', () => {
                    this.togglePlay();
                });

                // åœæ­¢æŒ‰é’®
                this.els.stopBtn.addEventListener('click', () => {
                    this.stop();
                });

                // è®¾ç½®æ§ä»¶
                this.els.rateInput.addEventListener('input', (e) => {
                    this.data.settings.rate = parseFloat(e.target.value);
                    this.els.rateDisp.textContent = this.data.settings.rate + 'x';
                    this.saveState();
                });

                this.els.intInput.addEventListener('input', (e) => {
                    this.data.settings.interval = parseInt(e.target.value);
                    this.els.intDisp.textContent = this.data.settings.interval + 's';
                    this.saveState();
                });

                this.els.repeatOpts.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const val = parseInt(e.target.dataset.val);
                        this.updateRepeatUI(val);
                        this.data.settings.repeats = val;
                        this.saveState();
                    });
                });
            },

            processWords() {
                const raw = this.els.input.value;
                // æ›´æ™ºèƒ½çš„åˆ†å‰²ï¼šé€—å·ã€ç©ºæ ¼ã€é¡¿å·ã€æ¢è¡Œ
                this.data.words = raw.split(/[,\uff0c\u3001\s\n]+/).filter(w => w.trim().length > 0);
                this.els.count.textContent = this.data.words.length;
            },

            // --- æ ¸å¿ƒæ’­æ”¾é€»è¾‘ ---

            togglePlay() {
                // 1. ç§»åŠ¨ç«¯éŸ³é¢‘è§£é” (Critical Fix)
                // å³ä½¿æ˜¯æš‚åœçŠ¶æ€ï¼Œç‚¹å‡»æŒ‰é’®ä¹Ÿå¿…é¡»å…ˆè§¦å‘ä¸€æ¬¡ speakï¼Œç¡®ä¿ AudioContext æ´»è·ƒ
                if (!this.data.isPlaying || this.data.isPaused) {
                    const unlock = new SpeechSynthesisUtterance('');
                    this.synth.speak(unlock);
                }

                // 2. é€»è¾‘åˆ†æ”¯
                if (this.data.isPlaying) {
                    if (this.data.isPaused) {
                        this.resume();
                    } else {
                        this.pause();
                    }
                } else {
                    this.start();
                }
            },

            start() {
                if (this.data.words.length === 0) {
                    this.shakeInput(); // è§†è§‰åé¦ˆ
                    return;
                }

                // åˆå§‹åŒ–çŠ¶æ€
                this.data.isPlaying = true;
                this.data.isPaused = false;
                this.data.currentIndex = 0;
                this.data.repeatCount = 0;
                this.data.isWaiting = false;

                // UI åˆ‡æ¢
                this.switchMode('play');
                this.els.stopBtn.disabled = false;
                this.els.stopBtn.classList.replace('text-slate-400', 'text-red-500');
                
                this.updatePlayBtnState(true, false);
                this.playNextWord();
            },

            playNextWord() {
                if (!this.data.isPlaying || this.data.isPaused) return;

                // æ£€æŸ¥æ˜¯å¦ç»“æŸ
                if (this.data.currentIndex >= this.data.words.length) {
                    this.finish();
                    return;
                }

                const word = this.data.words[this.data.currentIndex];
                
                // æ›´æ–° UI ä¿¡æ¯
                this.updateProgressUI(word, 'reading');

                // åˆ›å»ºè¯­éŸ³
                const u = new SpeechSynthesisUtterance(word);
                u.lang = 'zh-CN';
                u.rate = this.data.settings.rate;
                
                // äº‹ä»¶ç»‘å®š
                u.onend = () => {
                    if (!this.data.isPlaying) return;
                    
                    this.data.repeatCount++;
                    
                    if (this.data.repeatCount < this.data.settings.repeats) {
                        // è¿˜æ²¡è¯»å¤Ÿï¼Œç¨ä½œåœé¡¿åé‡è¯»
                        setTimeout(() => {
                            if(this.data.isPlaying && !this.data.isPaused) this.playNextWord(); // è¿™é‡Œçš„é€»è¾‘æ˜¯å†æ¬¡è°ƒç”¨ playNextWord ä½†ç´¢å¼•æ²¡å˜
                        }, 600);
                    } else {
                        // è¯»å¤Ÿäº†ï¼Œè¿›å…¥ç­‰å¾…ä¹¦å†™
                        this.data.repeatCount = 0; // é‡ç½®
                        this.startWaiting();
                    }
                };

                // ä¿®æ­£é‡å¤è°ƒç”¨çš„é€»è¾‘ï¼š
                // å¦‚æœæ˜¯åŒä¸ªè¯çš„ç¬¬Néï¼Œæˆ‘ä»¬ä¸éœ€è¦æ”¹å˜ currentIndex
                // è¿™é‡Œç›´æ¥ speak å³å¯
                
                // ä¸ºäº†å…¼å®¹æ€§ï¼Œå–æ¶ˆä¹‹å‰çš„é˜Ÿåˆ—
                this.synth.cancel();
                this.synth.speak(u);
            },

            startWaiting() {
                this.data.isWaiting = true;
                let timeLeft = this.data.settings.interval;
                
                this.updateProgressUI(this.data.words[this.data.currentIndex], 'waiting', timeLeft);

                // æ¸…é™¤æ—§å®šæ—¶å™¨
                if (this.data.timer) clearInterval(this.data.timer);

                this.data.timer = setInterval(() => {
                    if (!this.data.isPlaying || this.data.isPaused) {
                        clearInterval(this.data.timer);
                        return;
                    }

                    timeLeft--;
                    this.updateProgressUI(this.data.words[this.data.currentIndex], 'waiting', timeLeft);

                    if (timeLeft <= 0) {
                        clearInterval(this.data.timer);
                        this.data.isWaiting = false;
                        this.data.currentIndex++; // åªæœ‰ç­‰å¾…ç»“æŸæ‰è¿›ä¸‹ä¸€ä¸ªè¯
                        this.playNextWord();
                    }
                }, 1000);
            },

            pause() {
                this.data.isPaused = true;
                this.synth.cancel();
                clearInterval(this.data.timer);
                this.updatePlayBtnState(true, true);
                this.els.statusText.textContent = 'å·²æš‚åœ';
                this.els.currentWord.classList.add('opacity-50');
            },

            resume() {
                this.data.isPaused = false;
                this.updatePlayBtnState(true, false);
                this.els.currentWord.classList.remove('opacity-50');
                
                // æ¢å¤ç­–ç•¥ï¼šé‡è¯»å½“å‰è¯ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½
                this.data.repeatCount = 0; 
                this.playNextWord();
            },

            stop() {
                this.data.isPlaying = false;
                this.data.isPaused = false;
                this.synth.cancel();
                clearInterval(this.data.timer);
                
                this.switchMode('edit');
                this.els.stopBtn.disabled = true;
                this.els.stopBtn.classList.replace('text-red-500', 'text-slate-400');
                this.updatePlayBtnState(false);
            },

            finish() {
                this.stop();
                alert("ğŸ‰ å¬å†™å®Œæˆï¼");
            },

            // --- UI è¾…åŠ©æ–¹æ³• ---

            switchMode(mode) {
                if (mode === 'play') {
                    this.els.editMode.classList.add('opacity-0', 'pointer-events-none');
                    // å»¶è¿Ÿä¸€ç‚¹è®© editMode æ¶ˆå¤±åå†æ˜¾ç¤º playModeï¼Œé˜²æ­¢å¸ƒå±€è·³åŠ¨
                    setTimeout(() => {
                        this.els.editMode.style.display = 'none';
                        this.els.playMode.classList.remove('hidden');
                        this.els.input.blur(); // æ”¶èµ·é”®ç›˜
                    }, 300);
                } else {
                    this.els.playMode.classList.add('hidden');
                    this.els.editMode.style.display = 'block';
                    // å¼ºåˆ¶é‡ç»˜åå†æ˜¾ç¤º
                    requestAnimationFrame(() => {
                        this.els.editMode.classList.remove('opacity-0', 'pointer-events-none');
                    });
                }
            },

            updateProgressUI(word, state, timeLeft = 0) {
                // è¿›åº¦æ¡
                const pct = ((this.data.currentIndex) / this.data.words.length) * 100;
                this.els.progressBar.style.width = `${pct}%`;
                this.els.progressText.textContent = `${this.data.currentIndex + 1}/${this.data.words.length}`;
                
                this.els.currentWord.textContent = word;

                if (state === 'reading') {
                    this.els.statusText.textContent = `æ­£åœ¨æœ—è¯» (${this.data.repeatCount + 1}/${this.data.settings.repeats})`;
                    this.els.currentWord.classList.add('text-blue-600', 'scale-110');
                    this.els.currentWord.classList.remove('text-slate-900', 'scale-100');
                } else {
                    this.els.statusText.textContent = `è¯·ä¹¦å†™... ${timeLeft}s`;
                    this.els.currentWord.classList.remove('text-blue-600', 'scale-110');
                    this.els.currentWord.classList.add('text-slate-900', 'scale-100');
                }
            },

            updatePlayBtnState(isPlaying, isPaused) {
                if (!isPlaying) {
                    this.els.btnText.textContent = "å¼€å§‹å¬å†™";
                    this.els.playIcon.innerHTML = '<path d="M5 3l14 9-14 9V3z"/>'; // Play icon
                    this.els.mainBtn.classList.remove('bg-amber-500', 'shadow-amber-500/30');
                    this.els.mainBtn.classList.add('bg-[#007AFF]', 'shadow-blue-500/30');
                } else if (isPaused) {
                    this.els.btnText.textContent = "ç»§ç»­";
                    this.els.playIcon.innerHTML = '<path d="M5 3l14 9-14 9V3z"/>';
                    this.els.mainBtn.classList.remove('bg-amber-500', 'shadow-amber-500/30');
                    this.els.mainBtn.classList.add('bg-[#007AFF]', 'shadow-blue-500/30');
                } else {
                    this.els.btnText.textContent = "æš‚åœ";
                    this.els.playIcon.innerHTML = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>'; // Pause icon
                    this.els.mainBtn.classList.remove('bg-[#007AFF]', 'shadow-blue-500/30');
                    this.els.mainBtn.classList.add('bg-amber-500', 'shadow-amber-500/30');
                }
            },

            updateRepeatUI(val) {
                this.els.repeatOpts.forEach(btn => {
                    const btnVal = parseInt(btn.dataset.val);
                    if (btnVal === val) {
                        btn.className = 'repeat-opt flex-1 py-2 rounded-lg text-sm font-semibold transition-all shadow-sm bg-white text-slate-900 scale-100';
                    } else {
                        btn.className = 'repeat-opt flex-1 py-2 rounded-lg text-sm font-semibold text-slate-500 transition-all scale-95 hover:bg-slate-50';
                    }
                });
            },

            shakeInput() {
                this.els.input.classList.add('translate-x-2', 'duration-100', 'ease-in-out');
                setTimeout(() => this.els.input.classList.remove('translate-x-2'), 100);
                setTimeout(() => this.els.input.classList.add('-translate-x-2'), 200);
                setTimeout(() => this.els.input.classList.remove('-translate-x-2', 'duration-100', 'ease-in-out'), 300);
            },

            saveState() {
                localStorage.setItem('dictationProData', JSON.stringify({
                    words: this.els.input.value,
                    settings: this.data.settings
                }));
            },

            loadState() {
                try {
                    const raw = localStorage.getItem('dictationProData');
                    if (raw) {
                        const data = JSON.parse(raw);
                        if (data.words) {
                            this.els.input.value = data.words;
                            this.processWords();
                        }
                        if (data.settings) {
                            this.data.settings = { ...this.data.settings, ...data.settings };
                            // åŒæ­¥UI
                            this.els.rateInput.value = this.data.settings.rate;
                            this.els.rateDisp.textContent = this.data.settings.rate + 'x';
                            this.els.intInput.value = this.data.settings.interval;
                            this.els.intDisp.textContent = this.data.settings.interval + 's';
                            this.updateRepeatUI(this.data.settings.repeats);
                        }
                    }
                } catch (e) { console.error(e); }
            }
        };

        // å¯åŠ¨åº”ç”¨
        window.addEventListener('load', () => App.init());

    </script>
</body>
</html>


